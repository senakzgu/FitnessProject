@model FitnessApp.Models.ViewModels.TrainerEditViewModel

<h1>Edit Trainer</h1>
<hr />

<form asp-action="Edit">
    <input type="hidden" asp-for="Trainer.Id" />

    <div class="form-group">
        <label asp-for="Trainer.Name"></label>
        <input asp-for="Trainer.Name" class="form-control" />
    </div>

    <div class="form-group">
        <label asp-for="Trainer.Specialty"></label>
        <input asp-for="Trainer.Specialty" class="form-control" />
    </div>

    <div class="form-group">
        <label asp-for="Trainer.WorkingHours"></label>
        <input asp-for="Trainer.WorkingHours" class="form-control" />
    </div>

    <div class="form-group">
        <label asp-for="Trainer.GymId">Gym</label>
        <select asp-for="Trainer.GymId" class="form-control" asp-items="ViewBag.GymId"></select>
    </div>

    <h4>UzmanlÄ±k AlanlarÄ± (VerdiÄŸi Hizmetler)</h4>
    <div id="services-area">
        <p>Salon seÃ§iniz...</p>
    </div>


    <button type="submit" class="btn btn-primary mt-3">Save</button>
</form>

@section Scripts {
<script>

function loadServices(gymId, selectedIds) {

    if (!gymId) {
        document.getElementById("services-area").innerHTML =
            "<p>Ã–nce salon seÃ§iniz...</p>";
        return;
    }

    fetch(`/Services/GetServicesByGym?gymId=${gymId}`)
        .then(res => res.json())
        .then(list => {

            const div = document.getElementById("services-area");

            if (list.length === 0) {
                div.innerHTML = "<p>Bu salona ait hizmet bulunmuyor.</p>";
                return;
            }

            let html = "<ul class='list-group'>";

            list.forEach(s => {
                const isChecked = selectedIds.includes(s.id) ? "checked" : "";
                html += `
                    <li class="list-group-item">
                        <input type="checkbox" name="SelectedServiceIds"
                               value="${s.id}" ${isChecked} />
                        ${s.name}
                    </li>`;
            });

            html += "</ul>";

            div.innerHTML = html;
        });
}


// ðŸ‘‰ Page Loaded â†’ mevcut salon ve seÃ§ili hizmetleri yÃ¼kle
document.addEventListener("DOMContentLoaded", function () {

    const gymId = document.getElementById("Trainer_GymId").value;

    // Model.SelectedServiceIdsâ€™Ä± JS'ye aktarÄ±yoruz
    const selected = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.SelectedServiceIds));

    loadServices(gymId, selected);
});


// ðŸ‘‰ Gym deÄŸiÅŸince otomatik hizmetleri gÃ¼ncelle
document.getElementById("Trainer_GymId").addEventListener("change", function () {

    const gymId = this.value;

    // Yeni gym seÃ§ilince seÃ§ili hizmetler sÄ±fÄ±rlanmalÄ±
    loadServices(gymId, []);
});

</script>
}
